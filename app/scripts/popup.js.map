{"version":3,"sources":["../scripts.babel/popup.js"],"names":[],"mappings":"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","file":"popup.js","sourcesContent":["'use strict';\n\nangular\n  .module('misha', [\n    'ui.bootstrap.typeahead',\n    'ngAnimate',\n    'ngCookies',\n    'ngResource',\n    'ngRoute',\n    'ngSanitize'\n  ])\n  .config(function ($routeProvider) {\n    $routeProvider\n      .when('/user', {\n        templateUrl: 'views/main.html',\n        controller: 'MainCtrl',\n        controllerAs: 'main'\n      })\n      .when('/', {\n        controller:   'ListCtrl',\n        controllerAs: 'list',\n        templateUrl:  'views/list.html',\n      }).otherwise({\n        redirectTo: '/'\n      });\n  })\n\n  .controller('UserCtrl', ['$scope', '$resource', function ($scope, $resource) {\n\n  }])\n\n  .controller('ListCtrl', ['$scope', '$resource', '$http', function ($scope, $resource, $http) {\n    var api = 'http://misha-api.herokuapp.com';\n\n    var User = $resource(api + '/user/:userId', { userId: '@id' });\n    var Pending = $resource(api + '/pending/:userId', { userId: '@id' });\n\n    $scope.username = \"YOU\";\n    $scope.users = [];\n\n    chrome.storage.local.get('me', function(res) {\n      if(res.me && res.me.name) {\n        $scope.username = res.me.name.split(' ')[0];\n        $scope.me = res.me;\n      }\n    });\n\n    chrome.storage.local.get('users', function(res) {\n      $scope.users = res;\n    });\n\n    User.query({limit:2000}, function(res) {\n      $scope.users = res;\n      chrome.storage.local.set({'users': res});\n    });\n\n    $scope.notifyMe = function(userId) {\n      if (!userId) userId = $scope.selectedUser.id;\n      var notify = new Pending({\n        user_id: $scope.me.id,\n        waiting_for: userId,\n        message: 'is now available!'\n      });\n      notify.$save();\n      $scope.selectedUser = '';\n      $scope.appState = '';\n    };\n\n    $scope.sendMessage = function(userId, message) {\n      if (!userId) userId = $scope.selectedUser.id;\n      var notify = new Pending({\n        user_id: userId,\n        waiting_for: $scope.me.id,\n        message: message\n      });\n      notify.$save();\n      $scope.selectedUser = '';\n      $scope.appState = '';\n    }\n\n    $scope.selectUser = function(user) {\n      $scope.selectedUser = user;\n      $scope.appState = isAvailable(user) ? 'available' : 'busy';\n    }\n\n    function isAvailable(user) {\n      if (!user || !user.last_seen || !user.hasOwnProperty('last_seen')) return false;\n      var now = (new Date()).getTime();\n      var lastSeen;\n      lastSeen = (new Date(Number(user.last_seen))).getTime();\n      var isAvail = ((now - lastSeen) < (2 * 60 * 1000));\n      if (isAvail) {\n        return checkBusyCalendar(user.email)\n      } else {\n        return false;\n      }\n      return\n    }\n\n    function checkBusyCalendar(email) {\n      chrome.identity.getAuthToken({ 'interactive': true, scopes:['https://www.googleapis.com/auth/calendar']}, function(token) {\n        var now = new Date();\n        var next = new Date();\n        next.setTime(now.getTime() + (30*60*1000)); //half an hour\n        var nowI = now.toISOString();\n        var nextI = next.toISOString();\n\n        $http({\n          method: 'GET',\n          url: \"https://www.googleapis.com/calendar/v3/calendars/\" + email + \"/events?timeMin=\"+now.toISOString()+'&timeMax='+next.toISOString(),\n          headers: {\n            Authorization: 'OAuth '+token\n          }\n        }).then(function(data) {\n          data = data.data;\n          return(data && data.items && data.items.length > 0);\n        }, function(data) {return false});\n      });\n    }\n\n\n  }]);\n\n//  \"client_id_prod\": \"1051518271202-64fst397g2iqr3sahpvb8iohofi3t289.apps.googleusercontent.com\",\n"]}