{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n//\n//chrome.runtime\n//  .onInstalled.addListener(details => {\n//  console.log('previousVersion', details.previousVersion);\n//});\n\nvar api = 'http://misha-api.herokuapp.com';;\n//var api = 'http://localhost:1337';\n\nfunction isDevMode() {\n  return !('update_url' in chrome.runtime.getManifest());\n}\n\nvar api = isDevMode() ? 'http://localhost:1337' : 'http://misha-api.herokuapp.com';\nvar me = undefined;\nvar users = undefined;\n\nvar seenInterval = 12 * 1000;\nvar awayDuration = 2 * 60 * 1000;\n\nvar calenderCheckInterval = 5 * 60 * 1000;\nvar busyCalender = false;\nvar notifs = [];\nvar MAX_PER_DAY = 60 * 60 * 8;\nvar MAX_PER_WEEK = MAX_PER_DAY * 5;\n\nvar started = localStorage['started'];\n\nvar checkBusyCalendar = function () {\n  if (me && me.email) {\n    chrome.identity.getAuthToken({ 'interactive': true, scopes:['https://www.googleapis.com/auth/calendar']}, function(token) {\n      var now = new Date();\n      var next = new Date();\n      next.setTime(now.getTime() + (30*60*1000)); //half an hour\n      var nowI = now.toISOString();\n      var nextI = next.toISOString();\n\n      $.ajax({\n        url: \"https://www.googleapis.com/calendar/v3/calendars/\" + me.email + \"/events?timeMin=\"+now.toISOString()+'&timeMax='+next.toISOString(),\n        headers: {\n          Authorization: 'OAuth '+token\n        }\n      }).done(function(data) {\n        busyCalender = false;\n        if (data && data.items && data.items.length > 0) {\n          for (var i=0; i < data.items.length; i++) {\n            if (data.items[i].transparency != \"transparent\") {\n              busyCalender = true;\n              break;\n            }\n          }\n        }\n\n        console.log('busy calender result is: ', busyCalender)\n      });\n    });\n  } else {\n    busyCalender = false;\n  }\n};\n\n\nchrome.storage.local.get('notifications', function (res) {\n  if (res.notifications) {\n    notifs = res.notifications;\n    console.log('Get current messages: ', notifs);\n  }\n});\n\n//function isAvailable(user) {\n//  if (!user || !user.last_seen || !user.hasOwnProperty('last_seen')) return false;\n//  if (!user.status) return false;\n//  if (user.busy && user.busy != \"false\") return false;\n//  var now = (new Date()).getTime();\n//  var lastSeen;\n//  lastSeen = (new Date(Number(user.last_seen))).getTime();\n//  console.log(\"Last seen \" + (now - lastSeen) / 60 / 1000 + \" minutes ago\");\n//  return ((now - lastSeen) < (2 * 60 * 1000))\n//}\n\nvar calculateRate = function (ratesByDays, today, tomorrow) {\n  //returns a number between 0 and 1\n  var total = 0;\n  for (var i = 0; i < 7; i++) {\n    if (i != today && i != tomorrow) {\n      total += Number(ratesByDays[i]);\n    }\n  }\n  total = Math.min(1,    (total / MAX_PER_WEEK) //8 hours a day in the last 5 days is the max\n  );\n  return total;\n}\n\nfunction refreshUsers() {\n  $.get(api + '/user?limit=2000', function (res) {\n    users = res;\n  });\n}\n\nrefreshUsers();\nsetInterval(refreshUsers, 15 * 60 * 1000);\n\nvar seenLoop = function () {\n\n  var today = (new Date()).getDay();\n  var tomorrow = ((new Date()).getDay() + 1) % 7;\n\n  if (!me.rate || !me.rateByDay) {\n    var defaultRate = 60 * 60 * 4; //four hours\n    me.rateByDay = [defaultRate, defaultRate, defaultRate, defaultRate, defaultRate, defaultRate, defaultRate];\n    me.rate = calculateRate(me.rateByDay, today, tomorrow);\n  }\n\n  //clear next day data\n  me.rateByDay[tomorrow] = 0;\n\n  me.rate = calculateRate(me.rateByDay, today, tomorrow);\n\n  me.status =  me.status || 'available';\n\n  //if the user status is not busy - make sure he's not away\n  if (me.busy && me.busy != \"false\") {\n    chrome.browserAction.setIcon({'path': api + '/images/icons/red.png'})\n  } else {\n    chrome.browserAction.setIcon({'path': api + '/images/icons/' + (me.status=='available' ? 'green' : 'yellow') + '.png'})\n    if (typeof(me.reasons) == 'undefined') me.reasons = {};\n\n    //if not charging - set as away\n    navigator.getBattery().then(function (res) {\n      console.log('Got Battery: ', res);\n      if (!res.charging) {\n        console.log(\"You're running on battery power\");\n        me.reasons['Running on battery power'] = true;\n      } else {\n        console.log(\"You're NOT running on battery power\");\n        me.reasons['Running on battery power'] = false;\n      }\n    });\n\n    //if not if tel-aviv port - set as away\n    navigator.geolocation.getCurrentPosition(function (res) {\n\n      console.log('Got Location: ', res);\n      var lat = res.coords.latitude;\n      var lon = res.coords.longitude;\n\n      if (lat < 32.102660 && lat > 32.096141 && lon > 34.772296 && lon < 34.777674) {\n        //user is in the port\n        console.log(\"You're at Tel Aviv port\");\n        me.reasons['Not at Tel-Aviv Port'] = false;\n      } else {\n        console.log(\"You're NOT at Tel Aviv port\");\n        me.reasons['Not at Tel-Aviv Port'] = true;\n      }\n\n    });\n\n    //if chrome is idle for 2 minutes - set status as away\n    chrome.idle.queryState(2 * 60, function (res) {\n      console.log('Got Idle: ', res);\n      if (res != 'active') {\n        console.log(\"Chrome is idle\");\n        me.reasons['Chrome is idle'] = true;\n      } else {\n        console.log(\"Chrome is NOT idle\");\n        me.reasons['Chrome is idle'] = false;\n      }\n    });\n\n    //if (isAvailable(me)) {\n    //  console.log(\"Computer is NOT sleeping\");\n    //  me.reasons['Computer is sleeping'] = false;\n    //} else {\n    //  console.log(\"Computer is sleeping\");\n    //  me.reasons['Computer is sleeping'] = true;\n    //}\n    me.reasons['Computer is sleeping'] = false;\n\n    console.log('checking busy calender', busyCalender);\n    me.reasons['in meetings'] = busyCalender;\n\n    var r, reasons = [];\n    for (r in me.reasons) {\n      if (me.reasons.hasOwnProperty(r) && (me.reasons[r] && me.reasons[r] != \"false\")) {\n        reasons.push(r);\n      }\n    }\n\n    me.reason = \"\";\n    if (reasons.length > 0) {\n      me.status = 'away';\n      me.reason = reasons.join(' & ');\n    } else {\n      me.status = 'available';\n    }\n\n\n    //add seenInterval seconds to availability rate\n    me.rateByDay[today] = Math.min(Number(me.rateByDay[today]) + (seenInterval / 1000), MAX_PER_DAY);\n\n    $.post(api + '/user/seen?user_id=' + me.id, {user: me}, function (res) {\n      console.log(\"got response\", res);\n      console.count(\"got response\");\n\n      if (res.notify) {\n        //$.delete(api + '/pending/' + res.pending, function(res) {\n        //  console.log('Deleted: ', res);\n        //});\n\n        notifs.push(res);\n        chrome.storage.local.set({notifications: notifs}, function (err, localNotifs) {\n          console.log('Set current messages: ', localNotifs);\n        });\n\n        chrome.notifications.create('temp', {\n          type: \"basic\",\n          iconUrl: \"images/icon-128.png\",\n          title: res.user,\n          message: res.message,\n          expandedMessage: \" Expanded message\"\n\n        }, function (data) {\n          console.log('Notification callback', data);\n        })\n      }\n    });\n  }\n}\n\nvar initInterval = function () {\n  setInterval(seenLoop, seenInterval);\n  seenLoop();\n}\n\nvar getUserIdFromEmail = function (email) {\n  $.get(api + '/user?email=' + email, function (res) {\n    me = res[0];\n    console.log('Got User:', me);\n    initInterval();\n\n    setInterval(checkBusyCalendar, calenderCheckInterval);\n    checkBusyCalendar();\n  });\n}\n\nchrome.identity.getProfileUserInfo(function (res) {\n  if (res.email && res.email.indexOf('@wix.com') > 0) {\n    getUserIdFromEmail(res.email);\n  //} else {\n  //  chrome.storage.local.get('me', function(res) {\n  //    if (res.me) {\n  //      refreshUser();\n  //      initInterval(res.me);\n  //    } else {\n  //      chrome.identity.getAuthToken({ 'interactive': true }, function (token) {\n  //        //load Google's javascript client libraries\n  //\n  //        var x = new XMLHttpRequest();\n  //        x.open('GET', 'https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=' + token);\n  //        x.onload = function () {\n  //          var parsed_response = JSON.parse(x.response);\n  //          getUserIdFromEmail(parsed_response.email);\n  //        };\n  //        x.send();\n  //      });\n  //    }\n  //  });\n  }\n});\n"]}