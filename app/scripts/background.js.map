{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n//\n//chrome.runtime\n//  .onInstalled.addListener(details => {\n//  console.log('previousVersion', details.previousVersion);\n//});\n\n\nvar api = 'http://localhost:1337'; //'http://misha-api.herokuapp.com'\n\nvar me = undefined;\nchrome.identity.getProfileUserInfo(function(res) {\n  var email = res.email;\n  $.get(api+'/user?email=' + email, function(res) {\n    me = res[0];\n    chrome.storage.local.set({me: me});\n  });\n});\n\n\nvar initInterval = function (me) {\n  setInterval(function(){\n    $.post(api + '/user/seen?user_id=' + user.id, function(res) {\n      console.log(\"got response\", res);\n      console.count(\"got response\");\n\n      if (res.notify) {\n        chrome.browserAction.setBadgeText({text: '1'});\n        chrome.notifications.create('temp', {\n          type: \"basic\",\n          iconUrl: \"images/icon-128.png\",\n          title: res.message,\n          message: \"Default Message\",\n          expandedMessage: \" Expanded message\"\n\n        }, function(data) {\n          console.log('Notification callback', data);\n        })\n      }\n    });\n  }, 12000);\n}\n\nvar getUserIdFromEmail = function(email) {\n  $.get(api + '/user?email=' + email, function (res) {\n    var me = res[0];\n    chrome.storage.local.set({ me: me });\n    initInterval(me);\n  });\n}\n\n\nchrome.identity.getProfileUserInfo(function(res) {\n  if (res.email) {\n    getUserIdFromEmail(res.email);\n  } else {\n    chrome.storage.local.get('me', function(res) {\n      if (res.me) {\n        initInterval(res.me);\n      } else {\n        chrome.identity.getAuthToken({ 'interactive': true }, function (token) {\n          //load Google's javascript client libraries\n\n          var x = new XMLHttpRequest();\n          x.open('GET', 'https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=' + token);\n          x.onload = function () {\n            var parsed_response = JSON.parse(x.response);\n            getUserIdFromEmail(parsed_response.email);\n          };\n          x.send();\n        });\n      }\n    });\n  }\n});"]}